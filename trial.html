<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Casey Video Trial</title>
<style>
  :root { --accent:#4a4aff; }
  * { box-sizing: border-box; }
  body {
    background: #000;
    color: #fff;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    min-height: 100vh;
    margin: 0;
    padding: 40px 16px 24px;
    font-family: system-ui, Arial, sans-serif;
  }
  h1 { margin: 0 0 20px; text-align:center; }
  iframe {
    width: 720px;
    max-width: 100%;
    aspect-ratio: 16 / 9;
    border-radius: 12px;
    border: none;
    box-shadow: 0 0 20px rgba(255,255,255,0.25);
  }
  button.primary {
    margin-top: 20px;
    padding: 12px 24px;
    font-size: 18px;
    border: none;
    border-radius: 10px;
    background: var(--accent);
    color: white;
    cursor: pointer;
  }
  .overlay {
    position: fixed;
    inset: 0;
    display: none;
    align-items: center;
    justify-content: center;
    background: rgba(0,0,0,0.55);
    backdrop-filter: blur(2px);
    z-index: 10;
  }
  .card {
    width: min(92vw, 640px);
    background: #111218;
    border: 1px solid #262838;
    border-radius: 14px;
    padding: 20px;
    box-shadow: 0 16px 40px rgba(0,0,0,0.45);
  }
  .choices { display: grid; gap: 10px; margin-top: 8px; }
  .choices button {
    padding: 12px 16px;
    font-size: 16px;
    background: #1a1b27;
    color: #fff;
    border: 1px solid #2c2f45;
    border-radius: 10px;
    cursor: pointer;
    text-align: left;
  }
  .choices button:hover, .choices button:focus {
    outline: 2px solid var(--accent);
    outline-offset: 2px;
  }
</style>
</head>
<body>

<h1 id="stepTitle">Step 1</h1>

<!-- Replace local video with YouTube embed -->
<iframe id="ytplayer"
  src="https://www.youtube.com/watch?v=USLZJ5FTr-Y"
  title="Funny ducklings, ducks, pig, kitten and dog"
  allow="autoplay; encrypted-media"
  allowfullscreen>
</iframe>

<button id="continueBtn" class="primary" aria-label="Continue to Step 2">Continue</button>

<div id="quiz" class="overlay" role="dialog" aria-modal="true" aria-labelledby="quizQuestion">
  <div class="card">
    <h2 id="quizQuestion">question</h2>
    <div class="choices">
      <button data-choice="a">a</button>
      <button data-choice="b">b</button>
      <button data-choice="c">c</button>
    </div>
  </div>
</div>

<script>
  const title = document.getElementById('stepTitle');
  const btn = document.getElementById('continueBtn');
  const quizOverlay = document.getElementById('quiz');
  const quizButtons = quizOverlay.querySelectorAll('.choices button');

  // --- YouTube API setup ---
  let player;
  function onYouTubeIframeAPIReady() {
    player = new YT.Player('ytplayer', {
      events: {
        'onReady': onPlayerReady,
        'onStateChange': onPlayerStateChange
      }
    });
  }

  // load the API
  const tag = document.createElement('script');
  tag.src = "https://www.youtube.com/iframe_api";
  document.head.appendChild(tag);

  let loopEnabled = true;
  const loopEnd = 5;
  const quizTime = 10;
  let quizShown = false;

  function onPlayerReady() {
    player.mute();
    player.playVideo();
    monitor();
  }

  function monitor() {
    if (!player || typeof player.getCurrentTime !== 'function') {
      requestAnimationFrame(monitor);
      return;
    }
    const t = player.getCurrentTime();
    if (loopEnabled && t >= loopEnd) {
      player.seekTo(0);
      if (btn.style.display === 'none') btn.style.display = 'inline-block';
    }
    if (!loopEnabled && !quizShown && t >= quizTime) {
      quizShown = true;
      showQuiz();
    }
    requestAnimationFrame(monitor);
  }

  btn.addEventListener('click', () => {
    loopEnabled = false;
    btn.style.display = 'none';
    title.textContent = 'Step 2';
    player.seekTo(loopEnd);
    player.playVideo();
  });

  function showQuiz() {
    player.pauseVideo();
    quizOverlay.style.display = 'flex';
    setTimeout(()=> quizButtons[0].focus(),0);
  }

  function hideQuiz() {
    quizOverlay.style.display = 'none';
    player.playVideo();
  }

  quizButtons.forEach(b=>{
    b.addEventListener('click', e=>{
      const choice = e.currentTarget.getAttribute('data-choice');
      console.log('Choice:', choice);
      hideQuiz();
    });
  });

  function onPlayerStateChange(e){/* optional */}
</script>
</body>
</html>
